<div class="max-w-4xl mx-auto p-4 space-y-6">
  <!-- Step Navigation -->
  <div
    class="flex items-center justify-between bg-white border border-gray-200 rounded-md px-4 py-3 shadow-sm"
  >
    <div class="flex items-center gap-2 text-sm font-medium text-gray-700">
      <span class="text-gray-500">Step</span>
      <span class="px-2 py-0.5 bg-blue-50 text-blue-600 rounded font-semibold"
        >{{ step }}</span
      >
      <span class="text-gray-400">/ 3</span>
    </div>
    <div class="flex gap-2">
      <button
        type="button"
        (click)="back()"
        [disabled]="step===1"
        class="px-3 py-1.5 text-sm rounded border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-40 disabled:cursor-not-allowed"
      >
        Back
      </button>
      @if (step < 3) {
      <button
        type="button"
        (click)="next()"
        class="px-4 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50"
      >
        Next
      </button>
      }
    </div>
  </div>

  <!-- Step 1: Exam Details -->
  @if (step === 1) {
  <form
    [formGroup]="examForm"
    class="bg-white border border-gray-200 rounded-md shadow-sm p-6 space-y-5"
  >
    <h3 class="text-lg font-semibold text-gray-800">Exam Details</h3>
    <div class="space-y-1">
      <label class="block text-sm font-medium text-gray-600">Title</label>
      <input
        formControlName="title"
        class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
    </div>
    <div class="space-y-1">
      <label class="block text-sm font-medium text-gray-600">Description</label>
      <textarea
        formControlName="description"
        rows="3"
        class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
      ></textarea>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="space-y-1">
        <label class="block text-sm font-medium text-gray-600">Starts At</label>
        <input
          type="datetime-local"
          formControlName="startsAt"
          class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
      <div class="space-y-1">
        <label class="block text-sm font-medium text-gray-600">Ends At</label>
        <input
          type="datetime-local"
          formControlName="endsAt"
          class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="space-y-1">
        <label class="block text-sm font-medium text-gray-600">Year</label>
        <select
          formControlName="year"
          class="w-full rounded border border-gray-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option [value]="1">1</option>
          <option [value]="2">2</option>
          <option [value]="3">3</option>
          <option [value]="4">4</option>
        </select>
      </div>
      <div class="space-y-1">
        <label class="block text-sm font-medium text-gray-600">Section</label>
        <select
          formControlName="section"
          class="w-full rounded border border-gray-300 px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          <option value="a">A</option>
          <option value="b">B</option>
          <option value="c">C</option>
          <option value="d">D</option>
          <option value="e">E</option>
          <option value="f">F</option>
          <option value="g">G</option>
        </select>
      </div>
    </div>
  </form>
  }

  <!-- Step 2: Items Creation -->
  @if (step === 2) {
  <div
    class="bg-white border border-gray-200 rounded-md shadow-sm p-6 space-y-8"
  >
    <h3 class="text-lg font-semibold text-gray-800">Items</h3>

    <!-- MCQ -->
    <section class="space-y-3">
      <h4 class="font-medium text-gray-700">Multiple Choice</h4>
      <div class="space-y-1">
        <label class="block text-sm text-gray-600">Question</label>
        <input
          [(ngModel)]="mcqQuestion"
          name="mcqQuestion"
          class="w-full rounded border border-gray-300 px-3 py-2 text-sm"
        />
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        @for (opt of mcqOptions; track $index; let i = $index) {
        <div class="flex items-start gap-2">
          <input
            [(ngModel)]="opt.text"
            [name]="'opt'+i"
            placeholder="Option {{i+1}}"
            class="flex-1 rounded border border-gray-300 px-2 py-1 text-sm"
          />
          <label class="flex items-center gap-1 text-xs text-gray-600">
            <input
              type="checkbox"
              [(ngModel)]="opt.correct"
              [name]="'optCorrect'+i"
              class="rounded"
            />
            Correct
          </label>
        </div>
        }
      </div>
      <div class="flex items-center gap-4">
        <div class="space-y-1">
          <label class="block text-sm text-gray-600">Points</label>
          <input
            type="number"
            [(ngModel)]="mcqPoints"
            name="mcqPoints"
            class="w-24 rounded border border-gray-300 px-2 py-1 text-sm"
          />
        </div>
        <button
          type="button"
          (click)="addMcq()"
          class="mt-5 px-3 py-1.5 bg-blue-600 text-white text-sm rounded hover:bg-blue-700"
        >
          Add MCQ
        </button>
      </div>
    </section>

    <!-- True / False -->
    <section class="space-y-3 pt-4 border-t border-gray-100">
      <h4 class="font-medium text-gray-700">True / False</h4>
      <div class="space-y-1">
        <label class="block text-sm text-gray-600">Question</label>
        <input
          [(ngModel)]="tfQuestion"
          name="tfQuestion"
          class="w-full rounded border border-gray-300 px-3 py-2 text-sm"
        />
      </div>
      <div class="flex flex-wrap gap-4 items-end">
        <div class="space-y-1">
          <label class="block text-sm text-gray-600">Answer</label>
          <select
            [(ngModel)]="tfAnswer"
            name="tfAnswer"
            class="rounded border border-gray-300 px-2 py-1 text-sm bg-white"
          >
            <option value="true">True</option>
            <option value="false">False</option>
          </select>
        </div>
        <div class="space-y-1">
          <label class="block text-sm text-gray-600">Points</label>
          <input
            type="number"
            [(ngModel)]="tfPoints"
            name="tfPoints"
            class="w-24 rounded border border-gray-300 px-2 py-1 text-sm"
          />
        </div>
        <button
          type="button"
          (click)="addTrueFalse()"
          class="h-9 px-3 bg-blue-600 text-white text-sm rounded hover:bg-blue-700"
        >
          Add True/False
        </button>
      </div>
    </section>

    <!-- Essay -->
    <section class="space-y-3 pt-4 border-t border-gray-100">
      <h4 class="font-medium text-gray-700">Essay</h4>
      <div class="space-y-1">
        <label class="block text-sm text-gray-600">Question</label>
        <input
          [(ngModel)]="essayQuestion"
          name="essayQuestion"
          class="w-full rounded border border-gray-300 px-3 py-2 text-sm"
        />
      </div>
      <div class="space-y-1">
        <label class="block text-sm text-gray-600"
          >Expected Answer (optional)</label
        >
        <textarea
          [(ngModel)]="essayExpectedAnswer"
          name="essayExpectedAnswer"
          rows="3"
          class="w-full rounded border border-gray-300 px-3 py-2 text-sm"
        ></textarea>
      </div>
      <div class="flex items-center gap-4">
        <div class="space-y-1">
          <label class="block text-sm text-gray-600">Points</label>
          <input
            type="number"
            [(ngModel)]="essayPoints"
            name="essayPoints"
            class="w-24 rounded border border-gray-300 px-2 py-1 text-sm"
          />
        </div>
        <button
          type="button"
          (click)="addEssay()"
          class="mt-5 px-3 py-1.5 bg-blue-600 text-white text-sm rounded hover:bg-blue-700"
        >
          Add Essay
        </button>
      </div>
    </section>

    <!-- Items List -->
    <section class="space-y-3 pt-4 border-t border-gray-100">
      <h4 class="font-medium text-gray-700">Current Items</h4>
      @if (items.length === 0) {
      <div class="text-sm text-gray-500">No items yet.</div>
      } @else {
      <ul class="space-y-3">
        @for (item of items; track item.id) {
        <li class="border border-gray-200 rounded p-3 bg-gray-50">
          <div class="flex justify-between items-start">
            <div class="text-sm text-gray-800">
              <strong class="uppercase tracking-wide text-xs text-gray-500"
                >{{item.type}}</strong
              >
              <div>{{item.question}}</div>
              <div class="text-xs text-gray-500">Points: {{item.points}}</div>
            </div>
            <button
              type="button"
              (click)="removeItem(item.id)"
              class="text-xs text-red-600 hover:underline"
            >
              Remove
            </button>
          </div>
          @if (item.type === 'mcq') {
          <ul class="mt-2 space-y-1">
            @for (o of item.options; track $index) {
            <li class="text-xs text-gray-700">
              {{o.text}} @if (o.correct) {
              <span class="text-green-600 font-medium">(correct)</span> }
            </li>
            }
          </ul>
          } @if (item.type === 'truefalse') {
          <div class="mt-2 text-xs text-gray-700">
            Answer:
            <span class="font-medium">{{item.answer ? 'True' : 'False'}}</span>
          </div>
          } @if (item.type === 'essay') {
          <div class="mt-2 text-xs text-gray-700">
            Expected: {{item.expectedAnswer || 'N/A'}}
          </div>
          }
        </li>
        }
      </ul>
      }
      <div class="text-sm font-medium text-gray-700">
        Total Points: {{ totalPoints() }}
      </div>
    </section>
  </div>
  }

  <!-- Step 3: Review -->
  @if (step === 3) {
  <div
    class="bg-white border border-gray-200 rounded-md shadow-sm p-6 space-y-5"
  >
    <h3 class="text-lg font-semibold text-gray-800">Review</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
      <p>
        <span class="text-gray-500">Title:</span> {{ examForm.value.title }}
      </p>
      <p>
        <span class="text-gray-500">Status:</span> {{ examForm.value.status }}
      </p>
      <p class="md:col-span-2">
        <span class="text-gray-500">Description:</span> {{
        examForm.value.description }}
      </p>
      <p>
        <span class="text-gray-500">Starts:</span> {{ examForm.value.startsAt ||
        '—' }}
      </p>
      <p>
        <span class="text-gray-500">Ends:</span> {{ examForm.value.endsAt || '—'
        }}
      </p>
      <p><span class="text-gray-500">Items:</span> {{ items.length }}</p>
      <p>
        <span class="text-gray-500">Total Points:</span> {{ totalPoints() }}
      </p>
    </div>
    <ul class="space-y-2">
      @for (item of items; track item.id) {
      <li
        class="text-sm text-gray-800 border border-gray-200 rounded px-3 py-2 bg-gray-50"
      >
        <strong class="uppercase text-xs tracking-wide text-gray-500"
          >{{item.type}}</strong
        >
        <div>{{item.question}}</div>
        <div class="text-xs text-gray-500">Points: {{item.points}}</div>
      </li>
      }
    </ul>
    <button
      type="button"
      (click)="finalize()"
      [disabled]="items.length===0"
      class="px-5 py-2 bg-green-600 text-white text-sm font-medium rounded hover:bg-green-700 disabled:opacity-50"
    >
      Finalize & Save
    </button>
  </div>
  }
</div>
