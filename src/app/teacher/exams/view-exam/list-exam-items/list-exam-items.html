@let easyItemsSig = listExamItemsSvc.easyItems$();
@let moderateItemsSig = listExamItemsSvc.moderateItems$();
@let difficultItemsSig = listExamItemsSvc.difficultItems$();
@let exam = viewExamSvc.exam();



@if (exam) {
  <div class="space-y-4">
  <button type="button" class="flex w-full items-center justify-between rounded border bg-white px-3 py-2 text-left shadow-sm hover:bg-gray-50" (click)="isEasyOpen.set(!isEasyOpen())">
      <span class="text-lg font-semibold text-gray-900">Easy Exam Items ({{ easyItemsSig.length }})</span>
      <span class="text-gray-500 text-sm">{{ isEasyOpen() ? 'Hide' : 'Show' }}</span>
    </button>
    @if (isEasyOpen() && exam?.status === 'draft' && (exam.tos?.[0]?.distribution?.easy?.allocation ?? 0) > easyItemsSig.length) {
      <button (click)="isEasyEssayModalOpen.set(true)" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Add Essay</button>
      <app-essay-form-modal [examId]="exam.id" [level]="'easy'" (openModal)="isEasyEssayModalOpen.set(true)" (closeModal)="isEasyEssayModalOpen.set(false)" [isModalOpen]="isEasyEssayModalOpen()"></app-essay-form-modal>

      <button (click)="isEasyMcqModalOpen.set(true)" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">Add MCQ</button>
      <app-mcq-form-modal [examId]="exam.id" [level]="'easy'" (openModal)="isEasyMcqModalOpen.set(true)" (closeModal)="isEasyMcqModalOpen.set(false)" [isModalOpen]="isEasyMcqModalOpen()"></app-mcq-form-modal>

      <button (click)="isEasyTOFModalOpen.set(true)" class="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700 transition">Add True/False</button>
      <app-true-or-false-form-modal [examId]="exam?.id!" [level]="'easy'" (openModal)="isEasyTOFModalOpen.set(true)" (closeModal)="isEasyTOFModalOpen.set(false)" [isModalOpen]="isEasyTOFModalOpen()"></app-true-or-false-form-modal>

      <button (click)="isEasyFillBlankModalOpen.set(true)" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition">Add Fill in the Blank</button>
      <app-fill-blank-form-modal [examId]="exam?.id!" [level]="'easy'" (openModal)="isEasyFillBlankModalOpen.set(true)" (closeModal)="isEasyFillBlankModalOpen.set(false)" [isModalOpen]="isEasyFillBlankModalOpen()"></app-fill-blank-form-modal>

      <button (click)="isEasyShortAnswerModalOpen.set(true)" class="px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-700 transition">Add Short Answer</button>
      <app-short-answer-form-modal [examId]="exam?.id!" [level]="'easy'" (openModal)="isEasyShortAnswerModalOpen.set(true)" (closeModal)="isEasyShortAnswerModalOpen.set(false)" [isModalOpen]="isEasyShortAnswerModalOpen()"></app-short-answer-form-modal>

      <button (click)="isEasyMatchingModalOpen.set(true)" class="px-4 py-2 bg-rose-600 text-white rounded hover:bg-rose-700 transition">Add Matching</button>
      <app-matching-form-modal [examId]="exam?.id!" [level]="'easy'" (openModal)="isEasyMatchingModalOpen.set(true)" (closeModal)="isEasyMatchingModalOpen.set(false)" [isModalOpen]="isEasyMatchingModalOpen()"></app-matching-form-modal>
    }

    @if (isEasyOpen()) {
    <div class="space-y-3 mb-10">
      @for(item of easyItemsSig; track $index) {
        <div class="flex gap-1 flex-col">
          @if (exam?.status === 'draft') {
            <div class="flex justify-end gap-2">
              <button (click)="openUpdateModal(item)" class="text-xs text-blue-600 hover:text-blue-800">Edit</button>
              <button (click)="openDeleteModal(item)" class="text-xs text-red-600 hover:text-red-800">Delete</button>
            </div>
          }
          @if(item.type === 'mcq') {
            <app-mcq-item [item]="item"></app-mcq-item>
          } @else if(item.type === 'truefalse') {
            <app-true-false-item [itemSig]="item"></app-true-false-item>
          } @else if(item.type === 'essay') {
            <app-essay-item [itemSig]="item"></app-essay-item>
          } @else if(item.type === 'fillblank') {
            <app-fill-blank-item [itemSig]="item"></app-fill-blank-item>
          } @else if(item.type === 'shortanswer') {
            <app-short-answer-item [itemSig]="item"></app-short-answer-item>
          } @else if(item.type === 'matching') {
            <app-matching-item [itemSig]="item"></app-matching-item>
          }
        </div>
      } @empty {
        <div class="p-8 text-center border border-dashed rounded-lg bg-gray-50 text-gray-500 text-sm">
          <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          No items added yet.
        </div>
      }
    </div>
    }
  </div>

  <div class="space-y-4">
  <button type="button" class="flex w-full items-center justify-between rounded border bg-white px-3 py-2 text-left shadow-sm hover:bg-gray-50" (click)="isModerateOpen.set(!isModerateOpen())">
      <span class="text-lg font-semibold text-gray-900">Moderate Exam Items ({{ moderateItemsSig.length }})</span>
      <span class="text-gray-500 text-sm">{{ isModerateOpen() ? 'Hide' : 'Show' }}</span>
    </button>
 @if (isModerateOpen() && exam?.status === 'draft' && (exam.tos?.[0]?.distribution?.moderate?.allocation ?? 0) > moderateItemsSig.length) {
    <button (click)="isModerateEssayModalOpen.set(true)" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Add Essay</button>
    <app-essay-form-modal [examId]="exam?.id!" [level]="'moderate'" (openModal)="isModerateEssayModalOpen.set(true)" (closeModal)="isModerateEssayModalOpen.set(false)" [isModalOpen]="isModerateEssayModalOpen()"></app-essay-form-modal>

    <button (click)="isModerateMcqModalOpen.set(true)" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">Add MCQ</button>
    <app-mcq-form-modal [examId]="exam?.id!" [level]="'moderate'" (openModal)="isModerateMcqModalOpen.set(true)" (closeModal)="isModerateMcqModalOpen.set(false)" [isModalOpen]="isModerateMcqModalOpen()"></app-mcq-form-modal>

    <button (click)="isModerateTOFModalOpen.set(true)" class="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700 transition">Add True/False</button>
    <app-true-or-false-form-modal [examId]="exam?.id!" [level]="'moderate'" (openModal)="isModerateTOFModalOpen.set(true)" (closeModal)="isModerateTOFModalOpen.set(false)" [isModalOpen]="isModerateTOFModalOpen()"></app-true-or-false-form-modal>

   <button (click)="isModerateFillBlankModalOpen.set(true)" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition">Add Fill in the Blank</button>
   <app-fill-blank-form-modal [examId]="exam?.id!" [level]="'moderate'" (openModal)="isModerateFillBlankModalOpen.set(true)" (closeModal)="isModerateFillBlankModalOpen.set(false)" [isModalOpen]="isModerateFillBlankModalOpen()"></app-fill-blank-form-modal>

   <button (click)="isModerateShortAnswerModalOpen.set(true)" class="px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-700 transition">Add Short Answer</button>
   <app-short-answer-form-modal [examId]="exam?.id!" [level]="'moderate'" (openModal)="isModerateShortAnswerModalOpen.set(true)" (closeModal)="isModerateShortAnswerModalOpen.set(false)" [isModalOpen]="isModerateShortAnswerModalOpen()"></app-short-answer-form-modal>

   <button (click)="isModerateMatchingModalOpen.set(true)" class="px-4 py-2 bg-rose-600 text-white rounded hover:bg-rose-700 transition">Add Matching</button>
   <app-matching-form-modal [examId]="exam?.id!" [level]="'moderate'" (openModal)="isModerateMatchingModalOpen.set(true)" (closeModal)="isModerateMatchingModalOpen.set(false)" [isModalOpen]="isModerateMatchingModalOpen()"></app-matching-form-modal>
  }
    @if (isModerateOpen()) {
    <div class="space-y-3 mb-10">
      @for(item of moderateItemsSig; track $index) {
        <div class="flex gap-1 flex-col">
          @if (exam?.status === 'draft') {
            <div class="flex justify-end gap-2">
              <button (click)="openUpdateModal(item)" class="text-xs text-blue-600 hover:text-blue-800">Edit</button>
              <button (click)="openDeleteModal(item)" class="text-xs text-red-600 hover:text-red-800">Delete</button>
            </div>
          }
          @if(item.type === 'mcq') {
            <app-mcq-item [item]="item"></app-mcq-item>
          } @else if(item.type === 'truefalse') {
            <app-true-false-item [itemSig]="item"></app-true-false-item>
          } @else if(item.type === 'essay') {
            <app-essay-item [itemSig]="item"></app-essay-item>
          } @else if(item.type === 'fillblank') {
            <app-fill-blank-item [itemSig]="item"></app-fill-blank-item>
          } @else if(item.type === 'shortanswer') {
            <app-short-answer-item [itemSig]="item"></app-short-answer-item>
          } @else if(item.type === 'matching') {
            <app-matching-item [itemSig]="item"></app-matching-item>
          }
        </div>
      } @empty {
        <div class="p-8 text-center border border-dashed rounded-lg bg-gray-50 text-gray-500 text-sm">
          <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          No items added yet.
        </div>
      }
    </div>
    }
  </div>

  <div class="space-y-4">
  <button type="button" class="flex w-full items-center justify-between rounded border bg-white px-3 py-2 text-left shadow-sm hover:bg-gray-50" (click)="isDifficultOpen.set(!isDifficultOpen())">
      <span class="text-lg font-semibold text-gray-900">Difficult Exam Items ({{ difficultItemsSig.length }})</span>
      <span class="text-gray-500 text-sm">{{ isDifficultOpen() ? 'Hide' : 'Show' }}</span>
    </button>
    @if (isDifficultOpen() && exam?.status === 'draft' && (exam.tos?.[0]?.distribution?.difficult?.allocation ?? 0) > difficultItemsSig.length) {
    <button (click)="isDifficultEssayModalOpen.set(true)" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Add Essay</button>
    <app-essay-form-modal [examId]="exam?.id!" [level]="'difficult'" (openModal)="isDifficultEssayModalOpen.set(true)" (closeModal)="isDifficultEssayModalOpen.set(false)" [isModalOpen]="isDifficultEssayModalOpen()"></app-essay-form-modal>

    <button (click)="isDifficultMcqModalOpen.set(true)" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">Add MCQ</button>
    <app-mcq-form-modal [examId]="exam?.id!" [level]="'difficult'" (openModal)="isDifficultMcqModalOpen.set(true)" (closeModal)="isDifficultMcqModalOpen.set(false)" [isModalOpen]="isDifficultMcqModalOpen()"></app-mcq-form-modal>

    <button (click)="isDifficultTOFModalOpen.set(true)" class="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700 transition">Add True/False</button>
    <app-true-or-false-form-modal [examId]="exam?.id!" [level]="'difficult'" (openModal)="isDifficultTOFModalOpen.set(true)" (closeModal)="isDifficultTOFModalOpen.set(false)" [isModalOpen]="isDifficultTOFModalOpen()"></app-true-or-false-form-modal>

    <button (click)="isDifficultFillBlankModalOpen.set(true)" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition">Add Fill in the Blank</button>
    <app-fill-blank-form-modal [examId]="exam?.id!" [level]="'difficult'" (openModal)="isDifficultFillBlankModalOpen.set(true)" (closeModal)="isDifficultFillBlankModalOpen.set(false)" [isModalOpen]="isDifficultFillBlankModalOpen()"></app-fill-blank-form-modal>

    <button (click)="isDifficultShortAnswerModalOpen.set(true)" class="px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-700 transition">Add Short Answer</button>
    <app-short-answer-form-modal [examId]="exam?.id!" [level]="'difficult'" (openModal)="isDifficultShortAnswerModalOpen.set(true)" (closeModal)="isDifficultShortAnswerModalOpen.set(false)" [isModalOpen]="isDifficultShortAnswerModalOpen()"></app-short-answer-form-modal>

    <button (click)="isDifficultMatchingModalOpen.set(true)" class="px-4 py-2 bg-rose-600 text-white rounded hover:bg-rose-700 transition">Add Matching</button>
    <app-matching-form-modal [examId]="exam?.id!" [level]="'difficult'" (openModal)="isDifficultMatchingModalOpen.set(true)" (closeModal)="isDifficultMatchingModalOpen.set(false)" [isModalOpen]="isDifficultMatchingModalOpen()"></app-matching-form-modal>
  }
    @if (isDifficultOpen()) {
    <div class="space-y-3 mb-10">
      @for(item of difficultItemsSig; track $index) {
        <div class="flex gap-1 flex-col">
          @if (exam?.status === 'draft') {
            <div class="flex justify-end gap-2">
              <button (click)="openUpdateModal(item)" class="text-xs text-blue-600 hover:text-blue-800">Edit</button>
              <button (click)="openDeleteModal(item)" class="text-xs text-red-600 hover:text-red-800">Delete</button>
            </div>
          }
          @if(item.type === 'mcq') {
            <app-mcq-item [item]="item"></app-mcq-item>
          } @else if(item.type === 'truefalse') {
            <app-true-false-item [itemSig]="item"></app-true-false-item>
          } @else if(item.type === 'essay') {
            <app-essay-item [itemSig]="item"></app-essay-item>
          } @else if(item.type === 'fillblank') {
            <app-fill-blank-item [itemSig]="item"></app-fill-blank-item>
          } @else if(item.type === 'shortanswer') {
            <app-short-answer-item [itemSig]="item"></app-short-answer-item>
          } @else if(item.type === 'matching') {
            <app-matching-item [itemSig]="item"></app-matching-item>
          }
        </div>
      } @empty {
        <div class="p-8 text-center border border-dashed rounded-lg bg-gray-50 text-gray-500 text-sm">
          <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          No items added yet.
        </div>
      }
    </div>
    }
  </div>

  @if (isUpdateModalOpenSig()) {
    <app-update-item [itemInput]="selectedForUpdateSig()!" (itemSaved)="onItemSaved($event)" (close)="closeUpdateModal()"></app-update-item>
  }

  @if (isDeleteModalOpenSig()) {
  <app-delete-item [itemInput]="selectedForUpdateSig()!" (deleted)="onItemDeleted($event)" (close)="closeDeleteModal()"></app-delete-item>
  }
}
