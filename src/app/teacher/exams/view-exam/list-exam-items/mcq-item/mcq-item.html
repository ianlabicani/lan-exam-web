@let isEditing = isEditingSig();
@let item = itemSig();

<div class="rounded-lg border border-gray-200 bg-white shadow-sm p-4 space-y-4">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <span
      class="bg-blue-100 text-blue-700 text-[10px] font-semibold uppercase tracking-wide px-2 py-0.5 rounded-full"

    >
       MCQ
    </span>
    <span class="text-xs text-gray-500">{{ item.points }} pts</span>

    <button
      type="button"
      (click)="isEditingSig.set(!isEditing)"
      class="ml-auto text-xs px-3 py-1 rounded-md border text-gray-600 hover:bg-gray-100"
    >
      {{ isEditing ? 'Cancel' : 'Edit' }}
    </button>
  </div>

  <!-- ================= VIEW MODE ================= -->
  @if (!isEditing) {
    <div class="space-y-3">
      <!-- Question -->
      <p class="text-sm font-semibold text-gray-800">
        {{ item.question }}
      </p>

      <!-- Options -->
      <ul class="space-y-2">
        @for (opt of item.options; track $index) {
          <li
            class="flex items-center gap-2 px-3 py-2 rounded-md border"
            [ngClass]="{
              'border-green-400 bg-green-50': opt.correct,
              'border-gray-200 bg-gray-50': !opt.correct
            }"
          >
            <span
              class="inline-flex items-center justify-center w-5 h-5 rounded-full text-[11px] font-bold"
              [ngClass]="{
                'bg-green-500 text-white': opt.correct,
                'bg-gray-300 text-gray-700': !opt.correct
              }"
            >
              {{ 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[$index] }}
            </span>
            <span
              class="text-sm"
              [class.text-green-700.font-medium]="opt.correct"
            >
              {{ opt.text }}
            </span>
            @if (opt.correct) {
              <span
                class="ml-auto text-[11px] px-2 py-0.5 rounded-full bg-green-100 text-green-700 font-medium"
              >
                Correct
              </span>
            }
          </li>
        }
      </ul>
    </div>
  }

  <!-- ================= FORM MODE ================= -->
  @else {
    <form [formGroup]="mcqItemForm" (ngSubmit)="submit()" class="space-y-4">
      <!-- Question -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1"
          >Question</label
        >
        <textarea
          formControlName="question"
          placeholder="Enter question"
          rows="2"
          class="w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
        ></textarea>
      </div>

      <!-- Options -->
      <div formArrayName="options" class="space-y-3">
        <label class="block text-sm font-medium text-gray-700">Options</label>
        <ul class="space-y-2">
          @for (opt of mcqItemForm.controls.options.controls; track $index) {
            <li
              [formGroupName]="$index"
              class="flex items-center gap-2 w-full bg-gray-50 rounded-md px-3 py-2"
            >
              <input
                type="text"
                formControlName="text"
                placeholder="Option {{ $index + 1 }}"
                class="flex-1 rounded border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <label
                class="flex items-center gap-1 text-xs text-gray-600 whitespace-nowrap"
              >
                <input
                  type="checkbox"
                  formControlName="correct"
                  class="rounded"
                />
                Correct
              </label>
              <button
                type="button"
                (click)="removeOption($index)"
                class="text-xs text-red-600 hover:underline ml-2"
              >
                Remove
              </button>
            </li>
          }
        </ul>

        <button
          type="button"
          (click)="addOption()"
          class="mt-2 px-3 py-1 text-xs rounded bg-blue-500 text-white hover:bg-blue-600"
        >
          + Add Option
        </button>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Points</label>
        <input
          type="number"
          formControlName="points"
          min="1"
          class="w-24 rounded border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Points"
        />
      </div>



      <!-- Submit -->
      <div class="flex justify-end gap-2">
        <button
          type="button"
          (click)="isEditingSig.set(false)"
          class="px-3 py-1 rounded bg-gray-200 text-gray-700 text-sm hover:bg-gray-300"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="px-3 py-1 rounded bg-green-500 text-white text-sm hover:bg-green-600"
        >
          Save
        </button>
      </div>
    </form>
  }
</div>
