<div class="space-y-4">
  <!-- Question -->
  <form [formGroup]="mcqForm" (ngSubmit)="createItem()"></form>
  <div class="space-y-1">
    <label class="block text-sm font-medium text-gray-700"
      >Question<span class="text-red-500">*</span></label
    >
    <input
      type="text"
      class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
      [formControl]="mcqForm.controls.question"
      placeholder="Enter the question"
    />
  </div>

  <!-- Points -->
  <div class="space-y-1">
    <label class="block text-sm font-medium text-gray-700"
      >Points<span class="text-red-500">*</span></label
    >
    <input
      type="number"
      min="1"
      class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
      [formControl]="mcqForm.controls.points"
    />
  </div>

  <!-- Options -->
  <div class="space-y-2">
    <div class="flex items-center justify-between">
      <label class="text-sm font-medium text-gray-700"
        >Options<span class="text-red-500">*</span></label
      >
      <button
        type="button"
        (click)="addOption()"
        class="px-2 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 cursor-pointer"
        [disabled]="options.length >= MAX_OPTIONS"
      >
        <fa-icon [icon]="faPlus"></fa-icon>
      </button>
    </div>
    <div class="space-y-2">
      @for (opt of options.controls; track $index; let i = $index) {
      <div
        class="flex flex-col sm:flex-row sm:items-center gap-2 p-2 rounded border border-gray-200 w-full"
        [ngClass]="{
        'bg-green-100': opt.value.correct
        }"
        [formGroup]="opt"
      >
        <!-- Input full width -->
        <input
          type="text"
          class="flex-1 rounded border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-full"
          formControlName="text"
          placeholder="Option {{i+1}}"
        />
        <div
          class="flex items-center gap-3 sm:w-auto w-full justify-between sm:justify-start"
        >
          <label
            class="flex items-center gap-1 text-xs text-gray-600 select-none"
          >
            <input
              type="checkbox"
              formControlName="correct"
              (change)="toggleCorrect(i, $event)"
              class="rounded"
            />
            Correct
          </label>

          <button
            type="button"
            (click)="removeOption(i)"
            class="text-red-600 cursor-pointer bg-red-50 hover:bg-red-100 p-1 rounded"
            [disabled]="options.length <= MIN_OPTIONS"
          >
            <fa-icon [icon]="faTrash"></fa-icon>
          </button>
        </div>
      </div>

      }
      <p class="text-[11px] text-gray-500">
        Min {{MIN_OPTIONS}} options; max {{MAX_OPTIONS}}. Check at least one
        correct.
      </p>
    </div>
  </div>

  <!-- Validation messages -->

  @if (mcqForm.invalid) {

  <div class="space-y-1">
    @for (m of getErrorMessages(); track m) {
    <p class="text-xs text-red-600">{{ m }}</p>
    }
  </div>
  }

  <div class="pt-2 flex items-center gap-3">
    <button
      type="button"
      (click)="createItem()"
      [disabled]="mcqForm.invalid || saving()"
      class="px-4 py-2 text-xs font-medium rounded bg-blue-600 text-white disabled:opacity-40 flex items-center gap-2"
    >
      @if (!saving()) {<span>Create MCQ</span>} @else {<span
        class="flex items-center gap-1"
        ><span
          class="animate-spin w-3 h-3 border-2 border-white border-t-transparent rounded-full"
        ></span>
        Saving...</span
      >}
    </button>
    @if (errorMsg()) {<span class="text-xs text-red-600">{{ errorMsg() }}</span
    >}
  </div>
</div>
