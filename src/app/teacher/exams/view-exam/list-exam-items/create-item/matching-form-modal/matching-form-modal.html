@if (isModalOpen()) {
  <div class="fixed inset-0 bg-gray-900/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl p-6 relative">
      <button class="absolute top-3 right-3 text-gray-500 hover:text-gray-700" (click)="closeModal.emit()">âœ•</button>
      <h2 class="text-xl font-semibold mb-4">Add Matching</h2>

      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Question</label>
          <textarea formControlName="question" class="w-full rounded-lg border border-gray-300 p-2 mt-1 focus:ring focus:ring-blue-300 focus:outline-none" rows="3"></textarea>
          @if (form.get('question')?.invalid && form.get('question')?.touched) {
            <p class="text-red-500 text-sm mt-1">Question is required (min 3 chars).</p>
          }
        </div>

        <div>
          <div class="flex items-center justify-between">
            <label class="block text-sm font-medium text-gray-700">Pairs</label>
            <button type="button" (click)="addPair()" class="px-2 py-1 rounded bg-blue-600 text-white hover:bg-blue-700">Add Pair</button>
          </div>
          <div class="space-y-2 mt-2">
            @for (p of pairs.controls; track $index; let i = $index) {
              <div class="grid grid-cols-1 sm:grid-cols-[1fr_1fr_auto] gap-2 border rounded p-2" [formGroup]="$any(p)">
                <input class="rounded border border-gray-300 px-2 py-1" placeholder="Left" formControlName="left" />
                <input class="rounded border border-gray-300 px-2 py-1" placeholder="Right" formControlName="right" />
                <button type="button" (click)="removePair(i)" class="text-red-600 bg-red-50 hover:bg-red-100 px-2 py-1 rounded justify-self-start sm:justify-self-auto" [disabled]="pairs.length <= 2">Remove</button>
              </div>
            }
            <p class="text-[11px] text-gray-500">Provide at least 2 pairs.</p>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700">Points</label>
          <input type="number" formControlName="points" class="w-full rounded-lg border border-gray-300 p-2 mt-1 focus:ring focus:ring-blue-300 focus:outline-none" />
          @if (form.get('points')?.invalid && form.get('points')?.touched) {
            <p class="text-red-500 text-sm mt-1">Must be at least 1 point.</p>
          }
        </div>

        @if (errorMessage()) { <div class="text-sm text-red-600">{{ errorMessage() }}</div> }

        <div class="flex justify-end space-x-2 pt-4">
          <button type="button" (click)="closeModal.emit()" class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300">Cancel</button>
          <button type="submit" [disabled]="form.invalid || isSaving()" class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50">
            @if (!isSaving()) { <span>Save</span> } @else { <span>Saving...</span> }
          </button>
        </div>
      </form>
    </div>
  </div>
}
