@if (mcqFormModalService.isModalOpen()) {
  <div class="fixed inset-0 bg-gray-900/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-2xl p-6 relative">
      <button class="absolute top-3 right-3 text-gray-500 hover:text-gray-700" (click)="mcqFormModalService.closeModal()">âœ•</button>
      <h2 class="text-xl font-semibold mb-4">Add Multiple Choice Question</h2>

      <form [formGroup]="mcqForm" (ngSubmit)="onSubmit()" class="space-y-4">
        <!-- Question -->
        <div class="space-y-1">
          <label class="block text-sm font-medium text-gray-700">Question<span class="text-red-500">*</span></label>
          <input type="text" class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" formControlName="question" placeholder="Enter the question" />
          @if (mcqForm.get('question')?.invalid && mcqForm.get('question')?.touched) {
            <p class="text-red-500 text-sm mt-1">Question is required (min 3 chars).</p>
          }
        </div>

        <!-- Points -->
        <div class="space-y-1">
          <label class="block text-sm font-medium text-gray-700">Points<span class="text-red-500">*</span></label>
          <input type="number" min="1" class="w-full rounded border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" formControlName="points" />
          @if (mcqForm.get('points')?.invalid && mcqForm.get('points')?.touched) {
            <p class="text-red-500 text-sm mt-1">Must be at least 1 point.</p>
          }
        </div>

        <!-- Options -->
        <div class="space-y-2">
          <div class="flex items-center justify-between">
            <label class="text-sm font-medium text-gray-700">Options<span class="text-red-500">*</span></label>
            <button type="button" (click)="addOption()" class="px-2 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50" [disabled]="options.length >= MAX_OPTIONS">Add</button>
          </div>
          <div class="space-y-2">
            @for (opt of options.controls; track $index; let i = $index) {
              <div class="flex flex-col sm:flex-row sm:items-center gap-2 p-2 rounded border border-gray-200 w-full" [class.bg-green-100]="opt.value.correct" [formGroup]="opt">
                <input type="text" class="flex-1 rounded border border-gray-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 w-full" formControlName="text" placeholder="Option {{i+1}}" />
                <div class="flex items-center gap-3 sm:w-auto w-full justify-between sm:justify-start">
                  <label class="flex items-center gap-1 text-xs text-gray-600 select-none">
                    <input type="checkbox" formControlName="correct" class="rounded" />
                    Correct
                  </label>
                  <button type="button" (click)="removeOption(i)" class="text-red-600 bg-red-50 hover:bg-red-100 p-1 rounded" [disabled]="options.length <= MIN_OPTIONS">Remove</button>
                </div>
              </div>
            }
            <p class="text-[11px] text-gray-500">Min {{MIN_OPTIONS}} options; max {{MAX_OPTIONS}}. Check at least one correct.</p>
          </div>
        </div>

        <!-- Error -->
        @if (errorMessage()) {
          <div class="text-sm text-red-600">{{ errorMessage() }}</div>
        }

        <!-- Actions -->
        <div class="flex justify-end gap-2 pt-2">
          <button type="button" (click)="mcqFormModalService.closeModal()" class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">Cancel</button>
          <button type="submit" [disabled]="mcqForm.invalid || isSaving() || !hasAnyCorrect()" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50">
            @if (!isSaving()) { <span>Save</span> } @else { <span>Saving...</span> }
          </button>
        </div>
      </form>
    </div>
  </div>
}
