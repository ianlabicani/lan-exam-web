@let takenExamsSig = takenExams();

<div class="min-h-screen bg-gray-50">
	<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
		<!-- Header -->
		<div class="mb-8">
			<h1 class="text-3xl font-bold text-gray-900">Taken Exams</h1>
			<p class="text-gray-600 mt-2">Review your exam submissions and grades</p>
		</div>

		@if (!takenExamsSig.length) {
			<!-- Empty State -->
			<div class="rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-12 text-center">
				<div class="mx-auto mb-4 inline-flex h-12 w-12 items-center justify-center rounded-full bg-gray-200">
					<fa-icon [icon]="faFileLines" class="h-6 w-6 text-gray-600"></fa-icon>
				</div>
				<h3 class="text-lg font-medium text-gray-900">No taken exams yet</h3>
				<p class="mt-2 text-sm text-gray-600">Start an exam to see your submissions here</p>
			</div>
		} @else {
			<!-- Exams Grid -->
			<div class="grid gap-6 md:grid-cols-2 lg:grid-cols-1">
				@for (t of takenExamsSig; track t.id) {
					<div class="rounded-lg border border-gray-200 bg-white shadow-sm hover:shadow-md transition-shadow duration-200">
						<!-- Card Header -->
						<div class="border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4">
							<div class="flex items-start justify-between gap-4">
								<div class="flex-1">
									<h2 class="text-lg font-bold text-gray-900 line-clamp-2">{{ t.exam?.title | titlecase }}</h2>
									<p class="mt-1 text-sm text-gray-600">{{ t.exam?.description || '' }}</p>
								</div>
                  <span class="inline-flex items-center rounded-full bg-yellow-100 px-3 py-1 text-xs font-semibold text-yellow-800">
									@if (t.status === 'ongoing') {
											<fa-icon [icon]="faCircle" class="mr-1"></fa-icon>
											In Progress
                    } @else if ( t.status === 'submitted') {
                        <fa-icon [icon]="faCheckCircle" class="mr-1"></fa-icon>
                        Submitted
                    } @else {
                        <fa-icon [icon]="faCircle" class="mr-1"></fa-icon>
                        Graded
                    }
                  </span>
								</div>
						</div>

						<!-- Card Body -->
						<div class="px-6 py-4">
							<!-- Metadata Row -->
							<div class="grid grid-cols-2 gap-4 sm:grid-cols-4 mb-4">
								<div>
									<p class="text-xs font-semibold text-gray-500 uppercase">Exam Points</p>
									<p class="mt-1 text-lg font-bold text-gray-900">{{ t.exam?.total_points ?? '‚Äî' }}</p>
								</div>
								<div>
									<p class="text-xs font-semibold text-gray-500 uppercase">Your Score</p>
									<p class="mt-1 text-lg font-bold text-indigo-600">{{ t.total_points ?? '‚Äî' }}</p>
								</div>
								<div>
									<p class="text-xs font-semibold text-gray-500 uppercase">Percentage</p>
									<p class="mt-1 text-lg font-bold text-gray-900">
										@if (t.exam?.total_points && t.total_points) {
											{{ ((t.total_points / t.exam.total_points) * 100).toFixed(1) }}%
										} @else {
											‚Äî
										}
									</p>
								</div>
								<div>
									<p class="text-xs font-semibold text-gray-500 uppercase">Attempt</p>
									<p class="mt-1 text-lg font-bold text-gray-900">#{{ t.id }}</p>
								</div>
							</div>

							<!-- Timeline Info -->
							<div class="space-y-2 border-t border-gray-200 pt-4 text-sm text-gray-600">
								<div class="flex items-center justify-between">
									<span class="flex items-center gap-2">
										<fa-icon [icon]="faClock" class="h-4 w-4 text-gray-400"></fa-icon>
										Started
									</span>
									<span class="font-medium text-gray-900">{{ t.started_at | date: 'MMM dd, yyyy ‚Ä¢ h:mm a' }}</span>
								</div>
								@if (t.submitted_at) {
									<div class="flex items-center justify-between">
										<span class="flex items-center gap-2">
											<fa-icon [icon]="faCheckCircle" class="h-4 w-4 text-green-500"></fa-icon>
											Submitted
										</span>
										<span class="font-medium text-gray-900">{{ t.submitted_at | date: 'MMM dd, yyyy ‚Ä¢ h:mm a' }}</span>
									</div>
								}
							</div>

							<!-- Sections -->
							@if (t.exam?.sections?.length) {
								<div class="mt-4 border-t border-gray-200 pt-4">
									<p class="text-xs font-semibold text-gray-500 uppercase mb-2">Sections</p>
									<div class="flex flex-wrap gap-2">
										@for (sec of t.exam.sections; track $index) {
											<span class="inline-flex items-center rounded-md bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-700 border border-blue-200">
												Section {{ sec }}
											</span>
										}
									</div>
								</div>
							}

							<!-- Topics -->
							@if (t.exam?.tos?.length) {
								<div class="mt-4 border-t border-gray-200 pt-4">
									<p class="text-xs font-semibold text-gray-500 uppercase mb-2">Topics Covered</p>
									<div class="space-y-2">
										@for (topic of t.exam.tos; track $index) {
											<div class="rounded-md bg-gray-50 p-2.5">
												<p class="font-medium text-sm text-gray-900">{{ topic.topic }}</p>
												<p class="text-xs text-gray-600 mt-1">{{ topic.outcomes?.join(', ') }}</p>
												<div class="mt-1 flex gap-2 text-xs text-gray-500">
													<span>‚è±Ô∏è {{ topic.time_allotment }}m</span>
													<span>üìù {{ topic.no_of_items }} items</span>
												</div>
											</div>
										}
									</div>
								</div>
							}
						</div>

						<!-- Card Footer -->
						<div class="border-t border-gray-200 bg-gray-50 px-6 py-3">
							@if (t.submitted_at) {
								<a
									[routerLink]="['/student/taken-exams', t.id]"
									class="inline-flex items-center gap-2 rounded-md bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2"
								>
									<fa-icon [icon]="faEye" class="h-4 w-4"></fa-icon>
									View Submission
								</a>
							} @else {
								<a
									[routerLink]="['/student/taken-exams', t.id, 'continue']"
									class="inline-flex items-center gap-2 rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
								>
									<fa-icon [icon]="faArrowRight" class="h-4 w-4"></fa-icon>
									Continue Exam
								</a>
							}
						</div>
					</div>
				}
			</div>
		}
	</div>
</div>
