@let takenExamsSig = takenExams();

<div class="max-w-5xl mx-auto p-4">
	<h1 class="text-xl font-semibold text-slate-800 mb-4">Taken Exams</h1>

	@if (!takenExamsSig.length) {
		<div class="text-slate-500 text-sm">No taken exams found.</div>
	} @else {
		<div class="space-y-3">
			@for (t of takenExamsSig; track t.id) {
				<div class="rounded-lg border border-slate-200 bg-white p-4 shadow-sm">
					<div class="flex items-center justify-between">
						<div class="flex items-center gap-2">
							<span class="text-xs text-slate-500">Attempt #{{ t.id }}</span>
						</div>
						<div class="text-xs text-slate-500">
							Started: {{ t.started_at }}
							• Submitted: {{ t.submitted_at || '—' }}
						</div>
					</div>

					<div class="mt-3">
						<div class="font-medium text-slate-800">
              <p class="text-base md:text-lg leading-6 line-clamp-2 break-words">{{t.title | titlecase}}</p>

						</div>
						<div class="text-slate-600 text-sm">{{ t.exam?.description || '' }}</div>
					</div>

					<div class="mt-3 flex flex-wrap items-center gap-2 text-xs text-slate-600">
						<span>Total Points (Exam): <span class="font-semibold">{{ t.exam?.total_points ?? '—' }}</span></span>
						<span class="text-slate-300">|</span>
						<span>Scored: <span class="font-semibold">{{ t.total_points ?? '—' }}</span></span>
						<span class="text-slate-300">|</span>
						<span>Status: <span class="font-semibold">{{ t.submitted_at ? 'Submitted' : 'In Progress' }}</span></span>
					</div>

					@if (t.exam?.sections?.length) {
									<div class="mt-3 flex gap-1 flex-wrap">
							@for (sec of t.exam.sections; track $index) {
											<span class="inline-flex items-center justify-center rounded border px-2 py-0.5 text-[10px] font-semibold text-slate-600 bg-slate-50">
												<p>Section {{ sec }}</p>
											</span>
							}
						</div>
					}

					@if (t.exam?.tos?.length) {
						<div class="mt-3 text-xs text-slate-600">
							@for (topic of t.exam.tos; track $index) {
								<div class="py-1">
									<div class="font-semibold">{{ topic.topic }}</div>
									<div class="text-slate-500">Outcomes: {{ topic.outcomes?.join(', ') }}</div>
									<div class="text-slate-500">Time: {{ topic.time_allotment }} | Items: {{ topic.no_of_items }}</div>
								</div>
							}
						</div>
					}

          @if (t.submitted_at) {
            <a
              [routerLink]="['/student/taken-exams', t.id]"
              class="inline-flex items-center rounded-md bg-emerald-600 px-3 py-1.5 text-xs font-semibold text-white no-underline hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2"
            >
              View Submission
          </a>
            } @else {
            <a
              [routerLink]="['/student/taken-exams', t.id, 'continue']"
              class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white no-underline hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
            >
              Continue
          </a>
            }

				</div>
			}
		</div>
	}
</div>
